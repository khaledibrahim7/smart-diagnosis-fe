<div class="top-bar">
  <div class="language-switcher">
    <button [class.active]="userLang === 'en'" (click)="setLanguage('en')">🇬🇧 English</button>
    <button [class.active]="userLang === 'ar'" (click)="setLanguage('ar')">🇸🇦 العربية</button>
  </div>

</div>

<div class="diagnosis-container">
  <h1>👨‍⚕️ Smart Diagnosis</h1>
  <p>{{ userLang === 'ar' ? 'احصل على تشخيص طبي سريع بناءً على أعراضك.' : 'Get a quick medical diagnosis based on your symptoms.' }}</p>
  <button class="start-btn" (click)="openPopup(true)">
    🎙️ {{ userLang === 'ar' ? 'ابدأ التشخيص' : 'Start Diagnosis' }}
  </button>
</div>

<div class="chat-button-container" *ngIf="!isPopupOpen">
  <button class="ask-me-btn" (click)="openPopup(false)">🤖</button>
</div>

<div class="chat-modal" *ngIf="isPopupOpen">
  <div class="chat-modal-content">
    <div class="chat-header">
      <h5>{{ userLang === 'ar' ? 'مرحبًا، ابدأ المحادثة مع طبيبك الذكي...' : 'Welcome, start chatting with Smart Diagnosis...'
       }}</h5>
      <button class="close-btn" (click)="closePopup()">✖</button>
    </div>

    <div class="chat-body">
      <div *ngFor="let message of messages" [ngClass]="{ 'user-message': message.isUser, 'bot-message': !message.isUser }">
        {{ message.text }}
      </div>

      <div *ngIf="isTyping" class="typing-indicator">
        {{ userLang === 'ar' ? 'جاري الكتابة...' : 'Typing...' }}
      </div>
    </div>

    <div class="chat-footer">
      <input
        type="text"
        placeholder="{{ userLang === 'ar' ? 'اكتب رسالتك...' : 'Type your message...' }}"
        [(ngModel)]="userMessage"
        (keydown.enter)="sendMessage()"
      />
      <button class="send-btn" (click)="sendMessage()">
        {{ userLang === 'ar' ? 'إرسال' : 'Send' }}
      </button>
      <button class="mic-btn" (click)="toggleListening()">
        {{ isListening ? '🛑' : '🎤' }}
      </button>
    </div>
  </div>
</div>

<div class="loading-overlay" *ngIf="isLoading">
  <div class="spinner"></div>
  <p>{{ userLang === 'ar' ? 'جاري التحميل...' : 'Loading...' }}</p>
</div>