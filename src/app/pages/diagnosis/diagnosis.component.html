
<div class="top-bar">
  <div class="language-switcher">
    <button [class.active]="userLang === 'en'" (click)="setLanguage('en')">ğŸ‡¬ğŸ‡§ English</button>
    <button [class.active]="userLang === 'ar'" (click)="setLanguage('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
  </div>
</div>

<div class="diagnosis-container" *ngIf="!isPopupOpen">
  <h1>ğŸ‘¨â€âš•ï¸ Smart Diagnosis</h1>
  <p>
    {{ userLang === 'ar' ? 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªØ´Ø®ÙŠØµ Ø·Ø¨ÙŠ Ø³Ø±ÙŠØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø¹Ø±Ø§Ø¶Ùƒ.' : 'Get a quick medical diagnosis based on your symptoms.' }}
  </p>

 <button class="start-btn" (click)="goToAskDoctor()">
  {{ userLang === 'ar' ? 'Ø§Ø³Ø£Ù„ Ø¯ÙƒØªÙˆØ±' : 'Ask a Doctor' }}
</button>
</div>

<div class="chat-button-container" *ngIf="!isPopupOpen">
  <button class="ask-me-btn" (click)="openPopup()">ğŸ¤–</button>
</div>

<div class="chat-modal fullscreen" *ngIf="isPopupOpen">
  <div class="chat-modal-content">
    <div class="chat-header">
      <h5>{{ userLang === 'ar' ? 'Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø·Ø¨ÙŠØ¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ...' : 'Welcome, start chatting with Smart Diagnosis...' }}</h5>
      <button class="close-btn" (click)="closePopup()">âœ–</button>
    </div>

    <div class="chat-body-flex" [class.sidebar-hidden]="!showSidebar">
                <button 
            class="toggle-sidebar-icon" 
            [class.sidebar-collapsed]="!showSidebar" 
            (click)="toggleSidebar()"
          >
            {{ showSidebar ? 'Â«' : 'Â»' }}
          </button>
      <div class="chat-sidebar" [class.collapsed]="!showSidebar">
        <div class="sidebar-header">
          <button class="new-chat-btn" (click)="startNewChat('')">
            {{ userLang === 'ar' ? 'Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'New Chat' }}
          </button>
          <h4>{{ userLang === 'ar' ? 'Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©' : 'Previous Chats' }}</h4>
        </div>

        <div class="chat-history">
          <div *ngFor="let chat of chatHistory; let i = index" class="chat-history-item">
            <div class="chat-title" [class.active]="chat.chatId === activeChatId" (click)="loadChat(chat.chatId)">
              {{ chat.title || (userLang === 'ar' ? ('Ù…Ø­Ø§Ø¯Ø«Ø© ' + (i + 1)) : ('Chat ' + (i + 1))) }}
            </div>
            <div class="chat-options">
              <button class="options-btn" (click)="toggleOptionsMenu(i)">â‹®</button>
              <div *ngIf="openedMenuIndex === i" class="options-menu">
                <button (click)="shareChat(chat)">{{ userLang === 'ar' ? 'Ù…Ø´Ø§Ø±ÙƒØ©' : 'Share' }}</button>
                <button (click)="deleteChat(chat.chatId)">{{ userLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete' }}</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-main">
        <div class="chat-messages" #messageContainer>
          <div *ngIf="!activeChatId" class="welcome-message">
            {{ userLang === 'ar' ? 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©" Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ø¨Ø¯Ø¡.' : 'Click "New Chat" or select a chat to start.' }}
          </div>

          <div *ngIf="activeChatId">
            <div *ngFor="let message of messages" class="message" [ngClass]="{ 'user': message.isUser, 'bot': !message.isUser }">
              <div class="message-bubble">
                {{ message.text }}
              </div>
            </div>
          </div>
        </div>

        <div class="chat-footer" *ngIf="activeChatId">
          <input type="text" [(ngModel)]="userMessage" (keydown.enter)="sendMessage()" [placeholder]="userLang === 'ar' ? 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...' : 'Type your message...'" />
          <button class="mic-btn" (click)="toggleListening()">{{ isListening ? 'ğŸ›‘' : 'ğŸ¤' }}</button>
          <button class="send-btn" (click)="sendMessage()">{{ userLang === 'ar' ? 'Ø¥Ø±Ø³Ø§Ù„' : 'Send' }}</button>
        </div>
      </div>
    </div>
  </div>
</div>
