<div class="top-bar">
  <div class="language-switcher">
    <button [class.active]="userLang === 'en'" (click)="setLanguage('en')">ğŸ‡¬ğŸ‡§ English</button>
    <button [class.active]="userLang === 'ar'" (click)="setLanguage('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
  </div>
</div>

<div class="diagnosis-container">
  <h1>ğŸ‘¨â€âš•ï¸ Smart Diagnosis</h1>
  <p>{{ userLang === 'ar' ? 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªØ´Ø®ÙŠØµ Ø·Ø¨ÙŠ Ø³Ø±ÙŠØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø¹Ø±Ø§Ø¶Ùƒ.' : 'Get a quick medical diagnosis based on your symptoms.' }}</p>
  <button class="start-btn" (click)="openPopup(true)">
    ğŸ™ï¸ {{ userLang === 'ar' ? 'Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ´Ø®ÙŠØµ' : 'Start Diagnosis' }}
  </button>
</div>

<div class="chat-button-container" *ngIf="!isPopupOpen">
  <button class="ask-me-btn" (click)="openPopup(false)">ğŸ¤–</button>
</div>

<div class="chat-modal fullscreen" *ngIf="isPopupOpen">
  <div class="chat-modal-content">
    <div class="chat-header">
      <h5>{{ userLang === 'ar' ? 'Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø·Ø¨ÙŠØ¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ...' : 'Welcome, start chatting with Smart Diagnosis...' }}</h5>
      <button class="close-btn" (click)="closePopup()">âœ–</button>
    </div>

    <div class="chat-body">
      <div class="chat-sidebar">
        <h4>{{ userLang === 'ar' ? 'Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª' : 'Chats' }}</h4>
        <button class="new-chat-btn" (click)="startNewChat()">
          â• {{ userLang === 'ar' ? 'Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'New Chat' }}
        </button>

        <div class="chat-history">
          <div *ngFor="let chat of chatHistory; let i = index"
               class="chat-history-item"
               (click)="loadChat(i)">
            {{ userLang === 'ar' ? ('Ù…Ø­Ø§Ø¯Ø«Ø© ' + (i + 1)) : ('Chat ' + (i + 1)) }}
          </div>
        </div>
        <div *ngFor="let chat of chatHistory">
          <div (click)="loadChat(chat.id)" [class.active]="chat.id === activeChatId">
            <span>{{ chat.title }}</span>
            <button (click)="deleteChat(chat.id)">x</button>
          </div>
        </div>
        
      </div>

      <div class="chat-main">
        <div *ngFor="let message of messages" [ngClass]="{ 'user-message': message.isUser, 'bot-message': !message.isUser }">
          {{ message.text }}
        </div>

        <div *ngIf="isTyping" class="typing-indicator">
          {{ userLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©...' : 'Typing...' }}
        </div>
      </div>
    </div>

    <div class="chat-footer">
      <input
        type="text"
        placeholder="{{ userLang === 'ar' ? 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...' : 'Type your message...' }}"
        [(ngModel)]="userMessage"
        (keydown.enter)="sendMessage()"
      />
      <button class="mic-btn" (click)="toggleListening()">
        {{ isListening ? 'ğŸ›‘' : 'ğŸ¤' }}
      </button>
      <button class="send-btn" (click)="sendMessage()">
        {{ userLang === 'ar' ? 'Ø¥Ø±Ø³Ø§Ù„' : 'Send' }}
      </button>
      
    </div>
  </div>
</div>

<div class="loading-overlay" *ngIf="isLoading">
  <div class="spinner"></div>
  <p>{{ userLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'Loading...' }}</p>
</div>
